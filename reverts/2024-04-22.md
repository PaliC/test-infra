# Week of 2024-04-22 to 2024-04-29 (42)

### Ignored Signal (5)

- [Revert "[dtensor] move pad/unpad_tensor to separate utils (#124871)"](https://github.com/pytorch/pytorch/commit/359ff49bf471f2436739b3629db24f0ec73f5257)
  - Broke internal tests, see D56587991 for more details ([comment](https://github.com/pytorch/pytorch/pull/124871#issuecomment-2079001103))
- [Revert "Made FlexAttention rewrite getitem calls to use aten.index in score_mod (#124799)"](https://github.com/pytorch/pytorch/commit/678662a5577da0847c984b978f35ccf53d634a2d)
  - checking if this diff introduced regressions on linux-focal-py3.11-clang10 and linux-focal-py3.8-clang10 ([comment](https://github.com/pytorch/pytorch/pull/124799#issuecomment-2076756876))
- [Revert "[benchmark][cudagraph] Explicitly call aten.div with CUDA denominator for cudagraphs (#119729)"](https://github.com/pytorch/pytorch/commit/48a016157d7bbca4d17cffd1edcdfda5289b8032)
  - one PR in this stack seems to have broken linux pull cuda12 tests ([comment](https://github.com/pytorch/pytorch/pull/119729#issuecomment-2076750595))
- [Revert "[cudagraphs] add more info to skip messages (#124700)"](https://github.com/pytorch/pytorch/commit/6a92b352eead05cb34dd0140801a5e15d1b9e3ee)
  - one PR in this stack seems to have broken linux pull cuda12 tests ([comment](https://github.com/pytorch/pytorch/pull/119729#issuecomment-2076750595))
- [Revert "[cudagraphs] add cudagraph_skips counter (#124804)"](https://github.com/pytorch/pytorch/commit/154157416c0d36de399212a201b5d9125c12ee81)
  - one PR in this stack seems to have broken linux pull cuda12 tests ([comment](https://github.com/pytorch/pytorch/pull/119729#issuecomment-2076750595))

### Landrace (1)

- [Revert "fix Invalid call to aoti_torch_tensor_copy_ #123039 (#124037)"](https://github.com/pytorch/pytorch/commit/34bce27f0d12bf7226b37dfe365660aad456701a)
  - seems to have introduced a regression in pull / linux-focal-cuda12.1-py3.10-gcc9 / test (default, 3, 5, linux.4xlarge.nvidia.gpu) ([comment](https://github.com/pytorch/pytorch/pull/124037#issuecomment-2068659093))

### Not through pytorchbot (2)

- [Back out "Switch to predispatch" (#124860)](https://github.com/pytorch/pytorch/commit/674e15ae07d7749b40164e534c41db80bf7cc6c0)
- [Revert ARC jobs to run on classic infra again (#124748)](https://github.com/pytorch/pytorch/commit/98ffdf930c5bb93f547ff94a5d3af1f194cddbbc)

### No Signal (22)

- [Revert "fix Invalid call to aoti_torch_tensor_copy_ #123039 (#124037)"](https://github.com/pytorch/pytorch/commit/6b54f9d3e1b30cf270bf17ab47291a470edeac42)
  - introducing regressions in benchmark, see D56623194 for more details ([comment](https://github.com/pytorch/pytorch/pull/124037#issuecomment-2079574308))
- [Revert "Add common used score_mod functions for templated attention (#124670)"](https://github.com/pytorch/pytorch/commit/d1b25596d5f035188d8b07e5734306a4a0c21416)
  - Breaking internal CI, more info can be found in D56571389 ([comment](https://github.com/pytorch/pytorch/pull/124670#issuecomment-2079084881))
- [Revert "Refresh OpOverloadPacket if a new OpOverload gets added (#124654)"](https://github.com/pytorch/pytorch/commit/35a82d4a4ac357dacf9a0c790f2ba12a249d82ce)
  - Broken lots of internal signals, check D56571345 for more details ([comment](https://github.com/pytorch/pytorch/pull/124654#issuecomment-2078940680))
- [Revert "Verify types in custom op schemas (#124520)"](https://github.com/pytorch/pytorch/commit/a46c27d9615618f6570970b972cb4882a8accf82)
  - Breaking internal tests check D56588015 for more details ([comment](https://github.com/pytorch/pytorch/pull/124520#issuecomment-2078917978))
- [Revert "torch.mtia module for MTIA device backend (#123612)"](https://github.com/pytorch/pytorch/commit/e04c7b19f4d5ee3a3b42b1c15ded85650b12b628)
  - this PR broke ROCm with message RuntimeError: Cannot have MTIA with other devices ([comment](https://github.com/pytorch/pytorch/pull/123612#issuecomment-2077649762))
- [Revert "Add test_cpp_extensions tests for stream_and_event and mita_backend (#123614)"](https://github.com/pytorch/pytorch/commit/4a1299cc0ef481f8c14934b2ca98b4ca0280d819)
  - this PR broke ROCm with message RuntimeError: Cannot have MTIA with other devices ([comment](https://github.com/pytorch/pytorch/pull/123612#issuecomment-2077649762))
- [Revert "[inductor] Remove usage of device_interface from _inductor.runtime (#124592)"](https://github.com/pytorch/pytorch/commit/f6ce94dca5732eb19e65e612c22b0b86aa1146b5)
  - breaking internal tests, check D56522594 ([comment](https://github.com/pytorch/pytorch/pull/124592#issuecomment-2076957668))
- [Revert "[dynamo] Refactor into torch/_inductor/runtime/compile_tasks.py (#124681)"](https://github.com/pytorch/pytorch/commit/e520233526d0f2965c0d48d425622df0dc50ce8f)
  - breaking internal tests, check D56522594 ([comment](https://github.com/pytorch/pytorch/pull/124681#issuecomment-2076937810))
- [Revert "Add support for capturing tensors with score_mod (#124444)"](https://github.com/pytorch/pytorch/commit/0ca1ff3dce71b3fa4a905512ec7be381be753240)
  - Breaking internal tests, check D56522566 ([comment](https://github.com/pytorch/pytorch/pull/124444#issuecomment-2076908582))
- [Revert "Fast standalone symbolize for unwinding (#123966)"](https://github.com/pytorch/pytorch/commit/c0fd7894cca593a80ff474ed40ada7e94e2f4b0a)
  - Breaking internal builds, check D56522678 ([comment](https://github.com/pytorch/pytorch/pull/123966#issuecomment-2076821043))
- [Revert "[CUDA] Fix 64-bit indexing in `vol2col` in conv3d (#124650)"](https://github.com/pytorch/pytorch/commit/24ed909934925dcd3b99d23758003c08aa581153)
  - Reverting to check if it introduced regressions for linux-focal-rocm6.0-py3.8 tests ([comment](https://github.com/pytorch/pytorch/pull/124650#issuecomment-2076786795))
- [Revert "[cuDNN] cuDNN SDPA (Flash Attention) Backward (#122510)"](https://github.com/pytorch/pytorch/commit/7a6813b7b37d31f9702f3153c9427592511baa5b)
  - Breaking amd gpu builds ([comment](https://github.com/pytorch/pytorch/pull/122510#issuecomment-2076743868))
- [Revert "[quant][pt2e] Move batch norm op between eval/train for cuda (#123957)"](https://github.com/pytorch/pytorch/commit/e739a2d59e3391116f2ee68622e2a9c131c1edf6)
  - reverting to check if it will fix rocm jobs on main ([comment](https://github.com/pytorch/pytorch/pull/123957#issuecomment-2075158146))
- [Revert "AOTAutograd: gate view-replay behind config, not the default (#124488)"](https://github.com/pytorch/pytorch/commit/cc268a710d2d844b32d9f772d8d507ee36e3d64b)
  - submodule update causes xla to start failing see job on branch: https://github.com/pytorch/pytorch/actions/runs/8789091145/job/24124569508, Dr. CI incorrectly marked this as flaky and allowed the merge ([comment](https://github.com/pytorch/pytorch/pull/124488#issuecomment-2073568651))
- [Revert "[inductor] Refactor runtime files into torch._inductor.runtime (part 1) (#124552)"](https://github.com/pytorch/pytorch/commit/16eea7c6a5c5a3f937f4e6fdd9f5e94da78de982)
  - There are internal breakages, already discussed with author and he'll FF ([comment](https://github.com/pytorch/pytorch/pull/124552#issuecomment-2070548223))
- [Revert "[inductor] Refactor runtime files into torch._inductor.runtime (part 2) (#124553)"](https://github.com/pytorch/pytorch/commit/56714cb49755bc66bcf0868b1816759eacdd781b)
  - There are internal breakages, already discussed with author and he'll FF ([comment](https://github.com/pytorch/pytorch/pull/124552#issuecomment-2070548223))
- [Revert "[inductor] Refactor runtime files into torch._inductor.runtime (part 3) (#124557)"](https://github.com/pytorch/pytorch/commit/0b90af0bf51f35f17622cd332347bf56b831f2e8)
  - There are internal breakages, already discussed with author and he'll FF ([comment](https://github.com/pytorch/pytorch/pull/124552#issuecomment-2070548223))
- [Revert "[inductor] Refactor runtime files into torch._inductor.runtime (part 4) (#124559)"](https://github.com/pytorch/pytorch/commit/b3d6c2fe9b473c3bb57bb3ac2b9b60488104c397)
  - There are internal breakages, already discussed with author and he'll FF ([comment](https://github.com/pytorch/pytorch/pull/124552#issuecomment-2070548223))
- [Revert "[inductor] Refactor runtime files into torch._inductor.runtime (part 5) (#124560)"](https://github.com/pytorch/pytorch/commit/0f44ef93ab74dca80f79280b40d3b60d053c6014)
  - There are internal breakages, already discussed with author and he'll FF ([comment](https://github.com/pytorch/pytorch/pull/124552#issuecomment-2070548223))
- [Revert "[inductor] Remove config check for 3D tiling (#124569)"](https://github.com/pytorch/pytorch/commit/8973c5b8468e4620df47c092ff7e0fea4b9ef83f)
  - There are internal breakages, already discussed with author and he'll FF ([comment](https://github.com/pytorch/pytorch/pull/124552#issuecomment-2070548223))
- [Revert "[inductor] Use compile time config values in runtime (#124561)"](https://github.com/pytorch/pytorch/commit/30dec1da84a06588774f0f9fdfe5c9ad4beb0d03)
  - There are internal breakages, already discussed with author and he'll FF ([comment](https://github.com/pytorch/pytorch/pull/124561#issuecomment-2070537634))
- [Revert "[Environment Variable][1/N] Use thread-safe env variable API in c10 (#119449)"](https://github.com/pytorch/pytorch/commit/277ab8a4c0d483bc0166a7eaa482a57a5c42c381)
  - Broken internal signals, @albanD please help get this sorted :) ([comment](https://github.com/pytorch/pytorch/pull/119449#issuecomment-2069716129))

### Weird (12)

- [Revert "[TD] Query Github API for base (#122214)"](https://github.com/pytorch/pytorch/commit/b4d39a5de9a2b5a1bd9c5784131c1bb963299d68)
  - failing on main due to mistake ([comment](https://github.com/pytorch/pytorch/pull/122214#issuecomment-2079732105))
- [Revert "Delete erroneous print (#124972)"](https://github.com/pytorch/pytorch/commit/7324ddd80c9cefbe750d06c04c21dac0a9100ee2)
  - Need to revert #124654 but this PR depends on it :( ([comment](https://github.com/pytorch/pytorch/pull/124972#issuecomment-2078936303))
- [Revert "Fix mypy issues in fake_tensor.py (#124428)"](https://github.com/pytorch/pytorch/commit/f131c2c199a8f35c81d9823512a05e1657723f0f)
  - Unfortunately, I needed to revert #123735 and this one depends on it. So please check if there are no merge conflicts or breakages and feel free to merge this PR again ([comment](https://github.com/pytorch/pytorch/pull/124428#issuecomment-2078699836))
- [Revert "Fix global flake8 issues (#124771)"](https://github.com/pytorch/pytorch/commit/1ac60484c107ffe2b981bb05539af2160f4d7b61)
  - Unfortunately, I needed to revert #123735 and this one depends on it. So please check if there are no merge conflicts or breakages and feel free to merge this PR again ([comment](https://github.com/pytorch/pytorch/pull/124428#issuecomment-2078699836))
- [Revert "Refactor all top level usages of record_shapeenv_event to ShapeEnv class (#123735)"](https://github.com/pytorch/pytorch/commit/e607dc8abb89f225cceb140277e260a9b52dd06f)
  - Breaking internal signals, more info in D56587358 ([comment](https://github.com/pytorch/pytorch/pull/123735#issuecomment-2078695590))
- [Revert "Made FlexAttention rewrite getitem calls to use aten.index in score_mod (#124799)"](https://github.com/pytorch/pytorch/commit/e913f77c60b8c86434da3b8d88e6e6b6b2319e0b)
  - broke tests but only on crossref https://github.com/pytorch/pytorch/actions/runs/8841521519/job/24279075171, added no td label so itll actually run this time ([comment](https://github.com/pytorch/pytorch/pull/124799#issuecomment-2078530797))
- [Revert "remove empty partition (#124920)"](https://github.com/pytorch/pytorch/commit/b2f521f3769a9545b7c9df57569b1cba6116745b)
  - I think Dr CI is wrong, the xla failure looks real https://hud.pytorch.org/pytorch/pytorch/commit/98835fff9fd498472b0e8f49a3a4670d86f3c5b7 https://github.com/pytorch/pytorch/actions/runs/8840540357/job/24278180954 ([comment](https://github.com/pytorch/pytorch/pull/124920#issuecomment-2078495051))
- [Revert "Use recursive blob for package data (#119257)"](https://github.com/pytorch/pytorch/commit/33fae4fcf45cf68a59bdec9c64cb04d6461824c2)
  - This likely caused https://github.com/pytorch/pytorch/issues/124941, not sure why warning about recursive grep was ignored ([comment](https://github.com/pytorch/pytorch/pull/119257#issuecomment-2078312309))
- [Revert "OSS: Capture triton kernel in ET (#124775)"](https://github.com/pytorch/pytorch/commit/5f9ea261859075eedbc37cb0bc3f482986cb5cf0)
  - need to revert so I can revert https://github.com/pytorch/pytorch/pull/124592 ([comment](https://github.com/pytorch/pytorch/pull/124775#issuecomment-2076954322))
- [Revert "[ROCm] Triton upstream AMD backend integration (#121801)"](https://github.com/pytorch/pytorch/commit/3890848ec24bc432ffbf4ae6eb00cd9044cd0182)
  - need to revert so I can revert https://github.com/pytorch/pytorch/pull/124592 ([comment](https://github.com/pytorch/pytorch/pull/121801#issuecomment-2076951327))
- [Revert "Verify types in custom op schemas (#124520)"](https://github.com/pytorch/pytorch/commit/92295fbacddf01f6949b3d463f080fef331b6773)
  - broke static runtime tests ([comment](https://github.com/pytorch/pytorch/pull/124520#issuecomment-2075111935))
- [Revert "Add support for capturing tensors with score_mod (#124444)"](https://github.com/pytorch/pytorch/commit/4f3e1f1c93c578bda5afd6ea20fd80da04db7865)
  - This is weird, but somehow profile test started to timeout after this PR, see https://hud.pytorch.org/hud/pytorch/pytorch/main/1?per_page=50&name_filter=noGPU_AVX512 ([comment](https://github.com/pytorch/pytorch/pull/124444#issuecomment-2072506731))
