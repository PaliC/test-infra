# Week of 2024-07-22 to 2024-07-29 (58)

### GHFirst (32)

- [Revert "[BE] typing for decorators - fx/_compatibility (#131568)"](https://github.com/pytorch/pytorch/commit/945bf788943429ddfc219357eef76585d65263e9)
  - same as https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359 but I clicked the wrong link by accident.  This is where it actually starts ([comment](https://github.com/pytorch/pytorch/pull/131568#issuecomment-2254330781))
- [Revert "[BE] typing for decorators - masked/_ops (#131569)"](https://github.com/pytorch/pytorch/commit/b002ec61b6653ad0881818e3a5924f56e48bf0d5)
  - same as https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359 but I clicked the wrong link by accident.  This is where it actually starts ([comment](https://github.com/pytorch/pytorch/pull/131568#issuecomment-2254330781))
- [Revert "[BE] typing for decorators - library (#131570)"](https://github.com/pytorch/pytorch/commit/a3ba40587134739b7f232a294d5f3595d02fc798)
  - same as https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359 but I clicked the wrong link by accident.  This is where it actually starts ([comment](https://github.com/pytorch/pytorch/pull/131568#issuecomment-2254330781))
- [Revert "[BE] typing for decorators - distributed/_tensor/ops/utils (#131571)"](https://github.com/pytorch/pytorch/commit/a0abb77007e532faefdfeb249e019d71a6955cbe)
  - same as https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359 but I clicked the wrong link by accident.  This is where it actually starts ([comment](https://github.com/pytorch/pytorch/pull/131568#issuecomment-2254330781))
- [Revert "[BE] typing for decorators - _meta_registrations (#131572)"](https://github.com/pytorch/pytorch/commit/fd5b7d4bf959ac665a272f2d4ce50b2f3e60d254)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - _jit_internal (#131573)"](https://github.com/pytorch/pytorch/commit/609447a626fb014a84dfd384d40c121ea8bde825)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - _inductor/lowering (#131574)"](https://github.com/pytorch/pytorch/commit/4684b8e9d76ff28002c277025ac43f40de997400)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - _inductor/fx_passes/post_grad (#131575)"](https://github.com/pytorch/pytorch/commit/07b7f518776a94b31a63987bb46b7106242a0182)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - fx/experimental/migrate_gradual_types/constraint_generator (#131576)"](https://github.com/pytorch/pytorch/commit/6a0c3bae2198f13799f847ae7a748a69016ba4e8)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - ao/quantization/quantizer/xnnpack_quantizer_utils (#131577)"](https://github.com/pytorch/pytorch/commit/b1d640a2b7a48778ce02f3092952e0eac29e397d)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - _library/custom_ops (#131578)"](https://github.com/pytorch/pytorch/commit/d3c17fea907d19b3927ca6d1502a92333bb2d9db)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - fx/experimental/graph_gradual_typechecker (#131579)"](https://github.com/pytorch/pytorch/commit/065d0fe57086f73b0c29283c0e232133cfd334a9)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - utils/flop_counter (#131580)"](https://github.com/pytorch/pytorch/commit/5ced63a005a0f48cf72c48ab8ab8d5f5826fbd53)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - _refs/nn/functional (#131581)"](https://github.com/pytorch/pytorch/commit/2c4023d65f67c8ee07a40fc528692a58c0aa52a0)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[BE] typing for decorators - signal/windows/windows (#131582)"](https://github.com/pytorch/pytorch/commit/e448f32944d43b532fef3d16379ab44b51a71049)
  - breaking lint internally D60265575 ([comment](https://github.com/pytorch/pytorch/pull/131572#issuecomment-2254328359))
- [Revert "[inductor] Add type hints to functions in mkldnn_fusion.py (#131820)"](https://github.com/pytorch/pytorch/commit/d90f6b45c0cf55d4f2dfc9789ef90b9baba0258f)
  - reverting this to revert something else, only action you should need to do is to rebase and merge again, sorry for the churn ([comment](https://github.com/pytorch/pytorch/pull/131820#issuecomment-2254327833))
- [Revert "Fix public API tests (#131386)"](https://github.com/pytorch/pytorch/commit/8f5cf464054a191c23219e49cc6e3203b2396cfb)
  - reverting this to revert something else, only action you should need to do is to rebase and merge again, sorry for the churn ([comment](https://github.com/pytorch/pytorch/pull/131386#issuecomment-2254327487))
- [Revert "Add wrappers for synchronous GPUDirect Storage APIs (#130633)"](https://github.com/pytorch/pytorch/commit/e191b834623d2651691f97586bc95ba21dedd7a4)
  - still failing internally D60265673 ([comment](https://github.com/pytorch/pytorch/pull/130633#issuecomment-2253239607))
- [Revert "[BE] remove unnecessary _dispatch_sqrt by using ** 0.5 (#131358)"](https://github.com/pytorch/pytorch/commit/e4db5dc1c48184d317a88a1041b9a27076700c5e)
  - Internal uses this private API and landing that has been a pain so we're reverting this first ([comment](https://github.com/pytorch/pytorch/pull/131358#issuecomment-2253190654))
- [Revert "Fix static `py::object` dangling pointer with `py::gil_safe_call_once_and_store` (#130341)"](https://github.com/pytorch/pytorch/commit/161bb6711687a362603d8349cb8e29586770fa06)
  - unfortunately the internal pybind update got reverted cc @malfet ([comment](https://github.com/pytorch/pytorch/pull/130341#issuecomment-2253147079))
- [Revert "TCPStore: fix remote address (#131773)"](https://github.com/pytorch/pytorch/commit/696e83a1da79b15a6f0e34b78d736a67d0895a91)
  - broke internal builds D60265883, something about formatter ([comment](https://github.com/pytorch/pytorch/pull/131773#issuecomment-2253123800))
- [Revert "[reland][inductor] switch AotCodeCompiler to new cpp_builder (#130127)"](https://github.com/pytorch/pytorch/commit/bb64702eb348c981047006bfea6c012517cda091)
  - broke internal tests D60265910 ([comment](https://github.com/pytorch/pytorch/pull/130127#issuecomment-2253113689))
- [Revert "Fix vulkan builds with missing overrides errors (#131760)"](https://github.com/pytorch/pytorch/commit/7ee6831ae85f216b475f13f985192f71fc526c43)
  - Does not work with internal builds ([comment](https://github.com/pytorch/pytorch/pull/131760#issuecomment-2252783645))
- [Revert "MTIA equivalent of torch.cuda.memory_stats (#131673)"](https://github.com/pytorch/pytorch/commit/b343644f3ac9a89f4ad1bdc1581f8bc610e3cb73)
  - linked internal diff has internal changes, not sure what happened here, but this shouldn't have been merged externally without also merging the internal diff ([comment](https://github.com/pytorch/pytorch/pull/131673#issuecomment-2251749644))
- [Revert "Add flag to ignore unsupported @triton.autotune args in user-written kernel compilation (#131431)"](https://github.com/pytorch/pytorch/commit/f3df7deab8953af76ff1723ed49094208057a834)
  - broke internal tests D60211713 ([comment](https://github.com/pytorch/pytorch/pull/131431#issuecomment-2251091957))
- [Revert "Support IPC for Expandable Segments (#130890)"](https://github.com/pytorch/pytorch/commit/49a8e061b6d3a71f05e03e1ea2dd6e70f9cc30c7)
  - some internal tests show shutdown issues with the change to the table that holds ipc handles ([comment](https://github.com/pytorch/pytorch/pull/130890#issuecomment-2250767280))
- [Revert "Ensure staticmethods can be allowed in graph (#130882)"](https://github.com/pytorch/pytorch/commit/236e06f9f97db02b9f2b63ee14b9a1feef9a17b7)
  - torchrec test still broken internally D59945836 ([comment](https://github.com/pytorch/pytorch/pull/130882#issuecomment-2249003059))
- [Revert "Annotate all InstructionTranslator (#131509)"](https://github.com/pytorch/pytorch/commit/5db58656141ec272be3b698dc28df28de4acf7b7)
  - sorry need to revert this to revert something else, I think you only need to rebase and remerge ([comment](https://github.com/pytorch/pytorch/pull/131509#issuecomment-2249000843))
- [Revert "Add wrappers for synchronous GPUDirect Storage APIs (#130633)"](https://github.com/pytorch/pytorch/commit/e4b5645f831cf387172ca9cb97589f5f78a74614)
  - breaking a lot of jobs and build rules internally D60085885, possibly needs to update some bazel build? ([comment](https://github.com/pytorch/pytorch/pull/130633#issuecomment-2245806738))
- [Revert "Replace manual parsing of "TMPDIR", "TMP", "TEMP" and "TEMPDIR" with std::filesystem::temp_directory_path() (#130842)"](https://github.com/pytorch/pytorch/commit/5f0b65bee727f1c75275800e79c9e6ace9536507)
  - breaking some builds internally D60085710, Im not sure what the logs mean but I think its something about build size ([comment](https://github.com/pytorch/pytorch/pull/130842#issuecomment-2245799309))
- [Revert "Support IPC for Expandable Segments (#130890)"](https://github.com/pytorch/pytorch/commit/1e863878719a69ad52dddc34bfeaa08bf669f11d)
  - variable shadowing broke internal tests ([comment](https://github.com/pytorch/pytorch/pull/130890#issuecomment-2245456085))
- [Revert "[export] fix zero arg export in training_ir (#130990)"](https://github.com/pytorch/pytorch/commit/b9912f31ef91750ab29f6e2920bfdb05d37b7abe)
  - failing some executorch and torchrec tests internally D60006710 ([comment](https://github.com/pytorch/pytorch/pull/130990#issuecomment-2243395316))

### Ignored Signal (3)

- [Revert "immutable accessors in graph signature (#131807)"](https://github.com/pytorch/pytorch/commit/7339c8ab28ebd01474ea19a65001d433867f2acc)
  - Broke CI: [GH job link](https://github.com/pytorch/pytorch/actions/runs/10111847569/job/27965364355) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/608057afe23a295e1b167fa5d4edb348d05698ab) ([comment](https://github.com/pytorch/pytorch/pull/131807#issuecomment-2252875417))
- [Revert "[triton_op] fix autotuning (#131363)"](https://github.com/pytorch/pytorch/commit/6b8ec2b3716ce90d028218f8df059efbd210e1a4)
  - This was a tricky one, but looking at the code it's the change to torch/fx/node.py that triggered the type violation errors. Reverting since this is now breaking trunk ([comment](https://github.com/pytorch/pytorch/pull/131363#issuecomment-2245899858))
- [Revert "Added and_masks and or_masks utilities (#131073)"](https://github.com/pytorch/pytorch/commit/26383a6cc0197a30fee3d2d3f0626ed342fc9a28)
  - The docs build fails here and in trunk ([comment](https://github.com/pytorch/pytorch/pull/131073#issuecomment-2242997958))

### Landrace (2)

- [Revert "[custom ops] Add register_vmap for custom ops (#130589)"](https://github.com/pytorch/pytorch/commit/b435d8426114719150370b75376261c7eff61a42)
  - Please fix lint and reland ([comment](https://github.com/pytorch/pytorch/pull/130589#issuecomment-2244092174))
- [Revert "[TD] More synonyms, new heuristic for test_public_bindings (#130397)"](https://github.com/pytorch/pytorch/commit/44e689d94756f66ee2711a54239f6ba3bcf1cea0)
  - broke lint, probably a landrace, mergebase 13 days old ([comment](https://github.com/pytorch/pytorch/pull/130397#issuecomment-2243518651))

### Not through pytorchbot (1)

- [Revert D59561509: Multisect successfully blamed "D59561509: [FX][export] DCE pass, check schema for node impurity (#130395)" for one test failure (#131341)](https://github.com/pytorch/pytorch/commit/29e2e2afb694f5e4576c68521d11ddfad62ee994)

### No Signal (15)

- [Revert "[NestedTensor] Integrate the layer normalization operator along the jagged dimension into NestedTensor (#131519)"](https://github.com/pytorch/pytorch/commit/8cdfdb41bc2c4156b1b9d01a56bf83c94dc68c1d)
  - broke CI: test_nestedtensor.py::TestNestedTensorSubclassCPU::test_layer_norm_with_lengths_requires_grad_False_components_require_grad_False_cpu_float32 [GH job link](https://github.com/pytorch/pytorch/actions/runs/10121747545/job/27996722731) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/f862f457304f1952e75336f9f74e4ea3d2a5eb72) ([comment](https://github.com/pytorch/pytorch/pull/131519#issuecomment-2254167994))
- [Revert "[2/3] 3D Composability - move pp tests (#129801)"](https://github.com/pytorch/pytorch/commit/a38890a53f89c4e09cc10966853b5e90e4e4033a)
  - Broke periodic CI: distributed/_composable/test_composability/test_pp_composability.py::ComposabilityTest::test_manual_with_data_parallel_dp_type_DDP_ScheduleClass4 [GH job link](https://github.com/pytorch/pytorch/actions/runs/10083807511/job/27882848654) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/544f950d14e8ce4da0e592d9a3faac349e718151) ([comment](https://github.com/pytorch/pytorch/pull/129801#issuecomment-2253099894))
- [Revert "[3/3] 3D Composability - move tp dp tests (#129802)"](https://github.com/pytorch/pytorch/commit/546df5daf81c7c8c82932ae425f5f71fbb8e8601)
  - Need to revert https://github.com/pytorch/pytorch/pull/129801 that got remerged ([comment](https://github.com/pytorch/pytorch/pull/129802#issuecomment-2253082995))
- [Revert "[BE] typing for decorators - optim/optimizer (#131583)"](https://github.com/pytorch/pytorch/commit/c9888c273944c188a44424284bfc4384d957d056)
  - Breaks CI: [GH job link](https://github.com/pytorch/pytorch/actions/runs/10105959146/job/27947741162) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/a1dad77dfa4e244a867ca7c73e9f6b6fe36a1340) ([comment](https://github.com/pytorch/pytorch/pull/131583#issuecomment-2252784280))
- [Revert "[CUDAGraph] Type annotation for cudagraph_trees.py (#131621)"](https://github.com/pytorch/pytorch/commit/03f49c9523db2f307b749ef3fe1735f522941f78)
  - lint is failing, please rebase fix lint and reland ([comment](https://github.com/pytorch/pytorch/pull/131621#issuecomment-2251831163))
- [Revert "[2/3] 3D Composability - move pp tests (#129801)"](https://github.com/pytorch/pytorch/commit/d962dba0c44341b0e22d090be883a25fdd428dd9)
  - Broke periodic CI: distributed/_composable/test_composability/test_pp_composability.py::ComposabilityTest::test_manual_with_data_parallel_dp_type_DDP_ScheduleClass4 [GH job link](https://github.com/pytorch/pytorch/actions/runs/10083807511/job/27882848654) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/544f950d14e8ce4da0e592d9a3faac349e718151) ([comment](https://github.com/pytorch/pytorch/pull/129801#issuecomment-2250326191))
- [Revert "[BE] Get rid of missing destructor override warning (#131204)"](https://github.com/pytorch/pytorch/commit/eb54ca7abe3820d7d0512ab13dea681a6989c780)
  - sorry @malfet need to revert to make CI green, lets reland with ciflow/periodic label on ([comment](https://github.com/pytorch/pytorch/pull/131204#issuecomment-2248898033))
- [Revert "Fix py codegen to delete values that don't have any  users (#131028)"](https://github.com/pytorch/pytorch/commit/8ffd109a004edd3533f2dcc2d60007473c3a09e9)
  - breaks CI ([comment](https://github.com/pytorch/pytorch/pull/131028#issuecomment-2247771530))
- [Revert "[CI][dashboard] Collect PT2 cpu perf nightly (#131369)"](https://github.com/pytorch/pytorch/commit/84979307668f1dc75d4229b90388b30161a26e06)
  - Sorry need to revert looks like , please run ciflow/inductor looks like this caused failure in [pytorch/pytorch/actions/runs/10058412015/job/27802257096](https://github.com/pytorch/pytorch/actions/runs/10058412015/job/27802257096) ([comment](https://github.com/pytorch/pytorch/pull/131369#issuecomment-2246142022))
- [Revert "[CI] Relax config name matching for cpu inductor tests (#131467)"](https://github.com/pytorch/pytorch/commit/d4e3fd613ce63bb4e1d1863c98574b6902c2a5a6)
  - Sorry need to revert looks like https://github.com/pytorch/pytorch/pull/131369 broke inductor tests ([comment](https://github.com/pytorch/pytorch/pull/131467#issuecomment-2246136839))
- [Revert "Add sparse block to flex_decoding kernel (#130884)"](https://github.com/pytorch/pytorch/commit/6cbb1437c1c788693d09c005f4a444e1381153ad)
  - Sorry reverting test_causal_full_mask_vs_sdpa constantly failing on trunk ([comment](https://github.com/pytorch/pytorch/pull/130884#issuecomment-2244113663))
- [Revert "[c10d] remove non-necessary tests (#131212)"](https://github.com/pytorch/pytorch/commit/c74396e8904e55de842e3be5c58da285fe689361)
  - sorry need to revert breaks OSS CI, module 'test_c10d_common' has no attribute 'CompilerTest' ([comment](https://github.com/pytorch/pytorch/pull/131212#issuecomment-2243961785))
- [Revert "[inductor] Make UserDefinedTritonKernel a multi-output operation (#130832)"](https://github.com/pytorch/pytorch/commit/f8f41dcb24cb4f4e87a51bb04847942dd835e496)
  - broke periodic test ([comment](https://github.com/pytorch/pytorch/pull/130832#issuecomment-2243894772))
- [Revert "[inductor] Use multiple outputs for flex-attention (#130833)"](https://github.com/pytorch/pytorch/commit/15eb10df02052c11e74daf03f1816c293bd13c69)
  - broke periodic https://github.com/pytorch/pytorch/pull/130832 ([comment](https://github.com/pytorch/pytorch/pull/130833#issuecomment-2243890944))
- [Revert "[inductor] Kill mark_node_as_mutating (#130834)"](https://github.com/pytorch/pytorch/commit/f8875e8277e1d47b715c89ae24192e5f45f6a04e)
  - broke periodic https://github.com/pytorch/pytorch/pull/130832 ([comment](https://github.com/pytorch/pytorch/pull/130834#issuecomment-2243886215))

### Weird (5)

- [Revert "Add rerun_disabled_tests for inductor (#131681)"](https://github.com/pytorch/pytorch/commit/782efd8e5b75a3aa5da63dc34182f57587ccec31)
  - this is the wrong file ([comment](https://github.com/pytorch/pytorch/pull/131681#issuecomment-2253318038))
- [Revert "[BE][tests] show local variables on failure in tests (#131151)"](https://github.com/pytorch/pytorch/commit/0f9bf208ec0ee0aca3c1c107a0c7166589dc87ab)
  - pollutes test failure output for OpInfo tests ([comment](https://github.com/pytorch/pytorch/pull/131151#issuecomment-2253310448))
- [Revert "[dynamo] Turn on inline_inbuilt_nn_modules (#131275)"](https://github.com/pytorch/pytorch/commit/14920c149b95f55c6f504977a691ca7998de2e78)
  - I think this broke inductor/test_cpu_select_algorithm.py::TestSelectAlgorithmDynamicShapesCPU::test_quantized_linear_amx_dynamic_shapes_batch_size_16_in_features_4_out_features_64_bias_True_cpu [GH job link](https://github.com/pytorch/pytorch/actions/runs/10102272826/job/27938970118) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/0455344777f354dcbbd8e661a46ca2ca20e8a913) not run on PR due to bad TD ([comment](https://github.com/pytorch/pytorch/pull/131275#issuecomment-2251609554))
- [Revert "[reland][inductor] switch AotCodeCompiler to new cpp_builder (#130127)"](https://github.com/pytorch/pytorch/commit/fe2e6f0c518a83aa7276353642ca8718dcff4f3e)
  - False alarm, disable issue for the test got closed recently so the failure is unrelated ~Breask CI test_dataloader.py::TestDataLoader::test_segfault [GH job link](https://github.com/pytorch/pytorch/actions/runs/10099725941/job/27930133346) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/2c1851f04ebe945a9eb454d509eba7f6c5a6dc03)~ ([comment](https://github.com/pytorch/pytorch/pull/130127#issuecomment-2251360224))
- [Revert "Fix py codegen to delete values that don't have any  users (#131028)"](https://github.com/pytorch/pytorch/commit/c3679bed35dc282606741d6ef06d6d0a21c0cc8a)
  - broke inductor/test_triton_kernels inductor/test_triton_kernels.py::KernelTests::test_triton_kernel_functionalize [GH job link](https://github.com/pytorch/pytorch/actions/runs/10094659640/job/27915271250) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/91aba7baac3d2a079c0b13db25588842260c98cc) Bad TD, I added the label to run all tests ([comment](https://github.com/pytorch/pytorch/pull/131028#issuecomment-2251058374))
