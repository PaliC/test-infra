# Week of 2024-07-08 to 2024-07-15 (33)

### GHFirst (16)

- [Revert "[Inductor][CPP] Support vectorization of remainder (#129849)"](https://github.com/pytorch/pytorch/commit/1f162a5fce1b16835584f945f4c6d50bf42a2971)
  - fails the compilation of executorch benchmark internally ([comment](https://github.com/pytorch/pytorch/pull/129849#issuecomment-2227054413))
- [Revert "Fix static `py::object` dangling pointer with `py::gil_safe_call_once_and_store` (#130341)"](https://github.com/pytorch/pytorch/commit/ea78b0c17730114c70622f88dbf9e5ea790c5add)
  - internal needs pybind update ([comment](https://github.com/pytorch/pytorch/pull/130341#issuecomment-2226499397))
- [Revert "[inductor] switch AotCodeCompiler to new cpp_builder (#130127)"](https://github.com/pytorch/pytorch/commit/f0d7164cb93e4da0519178495c11a166bb586842)
  - breaks meta-internal tests ([comment](https://github.com/pytorch/pytorch/pull/130127#issuecomment-2226313943))
- [Revert "Simplify c10::string_view (#130009)"](https://github.com/pytorch/pytorch/commit/536b5b19b51acf59022c10f3483947feda04166f)
  - Diff reverted internally ([comment](https://github.com/pytorch/pytorch/pull/130009#issuecomment-2224223526))
- [Revert "Make c10::string_view an alias of std::string_view (#130417)"](https://github.com/pytorch/pytorch/commit/7ce5b5767ca9a4111a643f74ddab0ccb8c5e0dc9)
  - depends on #130009 which needs to be reverted ([comment](https://github.com/pytorch/pytorch/pull/130417#issuecomment-2224212227))
- [Revert "Add decompositions for copy variants of view ops (#128416)"](https://github.com/pytorch/pytorch/commit/d97d962082ed57dbf197a0b0fbcded447facf838)
  - breaks test_qs8_permute_copy test in executorch ([comment](https://github.com/pytorch/pytorch/pull/128416#issuecomment-2224023423))
- [Revert "Decompose expand_copy and permute_copy (#129476)"](https://github.com/pytorch/pytorch/commit/a2f630a9a4f2e092b6c99f58986af073a7a4f40b)
  - depends on #128416 which needs to be reverted ([comment](https://github.com/pytorch/pytorch/pull/129476#issuecomment-2224019720))
- [Revert "Add API for open registration between operators and subclasses (and modes) (#130064)"](https://github.com/pytorch/pytorch/commit/ce499eee0c629753097ff75e3612bdc88f260dca)
  - fails internal builds, see [D59553526](https://www.internalfb.com/diff/D59553526) ([comment](https://github.com/pytorch/pytorch/pull/130064#issuecomment-2221587575))
- [Revert "[custom_ops] expose torch.library.register_torch_dispatch (#130261)"](https://github.com/pytorch/pytorch/commit/86bca69c5f92208f321ca057bced5c9a735e1c32)
  - depends on #130064 which needs to be reverted ([comment](https://github.com/pytorch/pytorch/pull/130261#issuecomment-2221569707))
- [Revert "[reland][custom ops] infer schema (#130079)"](https://github.com/pytorch/pytorch/commit/e14a0f45ed86504c85b81e8a549c6d3d056e12e8)
  - depends on #130064 which needs to be reverted ([comment](https://github.com/pytorch/pytorch/pull/130079#issuecomment-2221561483))
- [Revert "Add block mask utility support for batches and heads > 1 (#130227)"](https://github.com/pytorch/pytorch/commit/fb696bf26457a60583f4c43f1a6547b16725c016)
  - breaks internal builds, please see D59498662 ([comment](https://github.com/pytorch/pytorch/pull/130227#issuecomment-2218842579))
- [Revert "Add scale kwarg to FlexAttention (and some changes that get FlexAttention numerics to be as accurate as FA2) (#130250)"](https://github.com/pytorch/pytorch/commit/44815ed67e8156053f706e646139efca17c0f129)
  - depends on #130227 which needs to be reverted ([comment](https://github.com/pytorch/pytorch/pull/130250#issuecomment-2218840674))
- [Revert "[runtime asserts] deduplicate runtime asserts & CSE (#128599)"](https://github.com/pytorch/pytorch/commit/9c9744c3acf73f7c43ed3a2e329b112fddfe0c85)
  - breaking internal APS tests, see D59498864 ([comment](https://github.com/pytorch/pytorch/pull/128599#issuecomment-2218724762))
- [Revert "[Inductor] Add aot_mode UT to new cpp_builder. (#130105)"](https://github.com/pytorch/pytorch/commit/f9bb258892cc71b863d8eb3686a361150be07ee2)
  - Breaks 46 tests internally at meta with: OSError: CUDA_HOME environment variable is not set ([comment](https://github.com/pytorch/pytorch/pull/130105#issuecomment-2215392198))
- [Revert "[inductor] switch AotCodeCompiler to new cpp_builder (#130127)"](https://github.com/pytorch/pytorch/commit/5e467604c3e94870105825c8cf8a8863b2cdb602)
  - Depends on #130105 which has to be reverted ([comment](https://github.com/pytorch/pytorch/pull/130127#issuecomment-2215355259))
- [Revert "[inductor] switch CppCodeCache to new cpp_builder. (#130132)"](https://github.com/pytorch/pytorch/commit/09d57f577b65df9434d72efaa5ee88fe99818e9d)
  - Depends on  #130105 which has to be reverted ([comment](https://github.com/pytorch/pytorch/pull/130132#issuecomment-2215352180))

### Ignored Signal (3)

- [Revert "[ONNX] Remove beartype usage (#130484)"](https://github.com/pytorch/pytorch/commit/0effcb70efe690ddb1890a4d9a28de8933c2f4c4)
  - Sorry for reverting your change but those failures show up in trunk after the commit landed https://hud.pytorch.org/pytorch/pytorch/commit/f44739cf42e22a569bd1bdb0c113f8a069c17a41, I am reverting it to see if it fix trunk ([comment](https://github.com/pytorch/pytorch/pull/130484#issuecomment-2226812311))
- [Revert "Change deprecated warning on dispatch_on_subclass to warn once (#130047)"](https://github.com/pytorch/pytorch/commit/492de213e27eb268ec62b9ee7be5718f472ab73f)
  - The failure on the PR are valid, they should not have been ignored ([comment](https://github.com/pytorch/pytorch/pull/130047#issuecomment-2223488933))
- [Revert "[pipelining] Refactor test_schedule to fix "-k" (#130294)"](https://github.com/pytorch/pytorch/commit/cd2638be097bd48b2cddf9b8795af05b1a51307c)
  - broke lint https://github.com/pytorch/pytorch/actions/runs/9879591538/job/27286156803 ([comment](https://github.com/pytorch/pytorch/pull/130294#issuecomment-2221376073))

### Landrace (2)

- [Revert "[cond] inlining into one of the branches when pred is a python constant (#128709)"](https://github.com/pytorch/pytorch/commit/0beeac35face64e6ceae8c3ad79e4ef0ed0829e7)
  - causing error on truck due to a land racing: https://hud.pytorch.org/pytorch/pytorch/commit/fe3e6878c4bb2a6001045c179fd7fa9838242558 ([comment](https://github.com/pytorch/pytorch/pull/128709#issuecomment-2221104043))
- [Revert "Add API for open registration between operators and subclasses (and modes) (#130064)"](https://github.com/pytorch/pytorch/commit/d44c30e2f90d9ebe829875324f0ac662d04833a8)
  - Sorry for reverting your change but test_profiler_tree is failing in trunk after this lands https://hud.pytorch.org/pytorch/pytorch/commit/922d2737d5e0ad22ee1dcf91c48ab09d641de840, maybe a landrace ([comment](https://github.com/pytorch/pytorch/pull/130064#issuecomment-2216135497))

### Not through pytorchbot (2)

- [Back out "[DeviceMesh] Only include the real thread_id in DeviceMesh hash under threaded backend (#130495)" (#130676)](https://github.com/pytorch/pytorch/commit/97cfc65dbc4f1d007eceba6cceda2f47af9adb94)
- [Revert some PRs (#130303)](https://github.com/pytorch/pytorch/commit/edf273edf4ac7490db86372850361ed2b1782607)

### No Signal (5)

- [Revert "[Inductor] FlexAttention supports partial masking (#130415)"](https://github.com/pytorch/pytorch/commit/da030e7addfe94f27fb9428245b854bc93f5917f)
  - Windows trunk test_proxy_tensor test failures look relevant  ([comment](https://github.com/pytorch/pytorch/pull/130415#issuecomment-2225575622))
- [Revert "Support for expandable segments with cuda graph trees (#128068)"](https://github.com/pytorch/pytorch/commit/578388bed82776b9faaa9bfc78c21088de7da9a8)
  - Reverting for breaking ROCm tests on trunk, I think the tests need to be qualified with @onlyCUDA ([comment](https://github.com/pytorch/pytorch/pull/128068#issuecomment-2223672381))
- [Revert "[halide-backend] Update CI pin (#130258)"](https://github.com/pytorch/pytorch/commit/f261c6ebe8cf0dad6f20668e4ad9d76731ada794)
  - Seems to have broken trunk pretty bad https://hud.pytorch.org/pytorch/pytorch/commit/4fcfd475bea24b832da32a0c4d464dd87c73a2a9 ([comment](https://github.com/pytorch/pytorch/pull/130258#issuecomment-2222935064))
- [Revert "update the input `weight` of `_convert_weight_to_int4pack` to `[n][k / 2] uint8` (#129940)"](https://github.com/pytorch/pytorch/commit/637cc8d27f26e9315eb8d6916778b193e811e365)
  - Broke rocm tests on main https://hud.pytorch.org/pytorch/pytorch/commit/6367f02a0e136ced05c665301bcdaa4d76690457 ([comment](https://github.com/pytorch/pytorch/pull/129940#issuecomment-2220554681))
- [Revert "[ROCm] Add int4 support (#129710)"](https://github.com/pytorch/pytorch/commit/d7b7f8b79f4ad5ffe0152649aa60a10b15eb744c)
  - original ROCm PR did not have ciflow/rocm, missed signal ([comment](https://github.com/pytorch/pytorch/pull/129710#issuecomment-2214558368))

### Weird (5)

- [Revert "Make hashing a SymInt raise an error again (#130548)"](https://github.com/pytorch/pytorch/commit/2b1df24877b2803342c0c8e49abc87a10c252728)
  - broke inductor/test_triton_kernels.py https://github.com/pytorch/pytorch/actions/runs/9908970127/job/27377960411 https://hud.pytorch.org/pytorch/pytorch/commit/3100455b8eeebdfbc3428ff9454579ac50666faf. Not run on PR due to bad TD ([comment](https://github.com/pytorch/pytorch/pull/130548#issuecomment-2225912018))
- [Revert "[aota] Needs autograd if an input requires_grad, agnostic to enable_grad (#128890)"](https://github.com/pytorch/pytorch/commit/b81767161ec3b9475a0e830e2bc5f35d4edd4a36)
  - broke inductor/test_flex_attention https://github.com/pytorch/pytorch/actions/runs/9879109008/job/27286339304 https://hud.pytorch.org/pytorch/pytorch/commit/08d5423d339ac4b302f8ae6b63b334e032104753 test was not run on PR due to bad TD ([comment](https://github.com/pytorch/pytorch/pull/128890#issuecomment-2221368245))
- [Revert "[HOP] Use user directed names for variables where possible (#130271)"](https://github.com/pytorch/pytorch/commit/3be4922a9dec2107bcf40ef43a470cacd3abf4ec)
  - broke inductor/test_flex_attention https://github.com/pytorch/pytorch/actions/runs/9863205414/job/27236960046 https://hud.pytorch.org/pytorch/pytorch/commit/adb65682affdfc37f724c02ea8c8930d3925fc07 Test not run on PR due to bad TD ([comment](https://github.com/pytorch/pytorch/pull/130271#issuecomment-2218832643))
- [Revert "[custom ops] infer schema (#130079)"](https://github.com/pytorch/pytorch/commit/44a773c12159a40afb5e31bd233984258774c1b7)
  - The test_public_bindings failure looks legit https://hud.pytorch.org/pytorch/pytorch/commit/3fe324ffb612c8712f6af7639c1e7bcec5f3b4fd ([comment](https://github.com/pytorch/pytorch/pull/130079#issuecomment-2215420957))
- [Revert "[3.12, 3.13, dynamo] simplified construction for frame f_locals/localsplus (#129185)"](https://github.com/pytorch/pytorch/commit/1e61cb8c871c876b6f8166d173dabd1440bda4f0)
  - dr ci categorization is wrong, the test_linalg xsuccess is real, theres also a test_jit failure https://github.com/pytorch/pytorch/actions/runs/9844339391/job/27178009798 https://hud.pytorch.org/pytorch/pytorch/commit/b428f1ad77aedfd150e920c8b0d23b7e6393ad6f ([comment](https://github.com/pytorch/pytorch/pull/129185#issuecomment-2215230345))
