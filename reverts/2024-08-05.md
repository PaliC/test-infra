# Week of 2024-08-05 to 2024-08-12 (27)

### GHFirst (9)

- [Revert "[Memory Snapshot][Viz] Show event timestamps if collected (#132523)"](https://github.com/pytorch/pytorch/commit/7f08b73980a9843acc0ccca9bb3daf95bc39fd3d)
  - Diff reverted internally ([comment](https://github.com/pytorch/pytorch/pull/132523#issuecomment-2282925079))
- [Revert "added persistent option to buffers and namedbuffers (#132994)"](https://github.com/pytorch/pytorch/commit/31ef900a653025bf6528c4f183d4bce7dbae704f)
  - breaking internal pyre tests ([comment](https://github.com/pytorch/pytorch/pull/132994#issuecomment-2278487672))
- [Revert "[ROCm] TunableOp logging improvements (#132173)"](https://github.com/pytorch/pytorch/commit/313aa151da1b84ccaa7fe0067a683490474f11da)
  - reverted internally ([comment](https://github.com/pytorch/pytorch/pull/132173#issuecomment-2276966242))
- [Revert "[pipelining] Add schedule runtime for lowered schedule (#130488)"](https://github.com/pytorch/pytorch/commit/3ec9ec03a8002bb6ac72a975e09824f6a6e1e734)
  - breaking distributed tests internally (that should be running in OSS) ([comment](https://github.com/pytorch/pytorch/pull/130488#issuecomment-2276266909))
- [Revert "[Inductor][CPP] Turns on inline_inbuilt_nn_modules for CPP GEMM template testing (#132487)"](https://github.com/pytorch/pytorch/commit/b885ad8fce567f1f8259dc59313adc1db532f94b)
  - this pr is breaking inductor tests internally ([comment](https://github.com/pytorch/pytorch/pull/132487#issuecomment-2276142742))
- [Revert "Populate submodules of `torch._C` to `sys.modules` recursively (#132216)"](https://github.com/pytorch/pytorch/commit/ff81ca8e0cb6c8b543b1a8e6928913a10a668a02)
  - was breaking internal builds ([comment](https://github.com/pytorch/pytorch/pull/132216#issuecomment-2274112397))
- [Revert "Deprecate `torch._utils.is_compiling()` and `torch._dynamo.external_utils.is_compiling()` (#127690)"](https://github.com/pytorch/pytorch/commit/cbee9c1fd2b08b04af5b0bdf472254ffd3bbe231)
  - breaking internal builds ([comment](https://github.com/pytorch/pytorch/pull/127690#issuecomment-2272370386))
- [Revert "Temp disable MKL in  DistributionKernels.cpp (#132532)"](https://github.com/pytorch/pytorch/commit/e47b684c3346b5330d1e03792e0565fb1c472bc7)
  - causing numerical instability issues internally ([comment](https://github.com/pytorch/pytorch/pull/132532#issuecomment-2272136210))
- [Revert "[inductor] export kernel for gemm template. (#132580)"](https://github.com/pytorch/pytorch/commit/7100c36c8a170db3b73e0c293d5366cfe6318c4d)
  - sys is not defined in torch/_inductor/codegen/cpp_utils.py ([comment](https://github.com/pytorch/pytorch/pull/132580#issuecomment-2271264974))

### Landrace (2)

- [Revert "[BE] Reroute all uses of proxy_tensor.maybe_disable_fake_tensor_mode to fake_tensor.unset_fake_temporarily (#132770)"](https://github.com/pytorch/pytorch/commit/d1f73fd844ba8b84dc1ac581f0c938c6a64d823f)
  - Removed API was recommitted ([comment](https://github.com/pytorch/pytorch/pull/132770#issuecomment-2275749689))
- [Revert "Only thunkify proxies in some situations (#132421)"](https://github.com/pytorch/pytorch/commit/780310fed7f6d1992bc210ac1a16da04df9e39c2)
  - I think this broke dynamo/test_subclasses.py::TestNestedTensor::test_in_graph_construction_from_input [GH job link](https://github.com/pytorch/pytorch/actions/runs/10283744685/job/28459340678) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/bb99008c9e7c357b88047bcd6971dc2078341484).  Test got added in https://github.com/pytorch/pytorch/commit/f50621989b81145d2677b382ee2ec0ca2b481fdc which is before your merge base ([comment](https://github.com/pytorch/pytorch/pull/132421#issuecomment-2273742960))

### Not through pytorchbot (1)

- [Revert "Construct NJT without graph breaks" (#133145)](https://github.com/pytorch/pytorch/commit/05de2b2d0fd582e102f469e55a8a7212aef94a70)

### No Signal (4)

- [Revert "[CUDA][CUTLASS][submodule] Fixes for CUTLASS upgrade (#131493)"](https://github.com/pytorch/pytorch/commit/465e071898e1491b0417bb8bdcb2f4d9e512d8de)
  - breaking many tests ([comment](https://github.com/pytorch/pytorch/pull/131493#issuecomment-2277738114))
- [Revert "[ts-migration]: Support quantized operation transformation (#131915)"](https://github.com/pytorch/pytorch/commit/6f99e97f0aee415f1e6092cf4fb325055c27b74f)
  - test broken on windows https://hud.pytorch.org/pytorch/pytorch/commit/0e8541766fe5ed58c54aa530eee8e34832539199 (merged without trunk label) ([comment](https://github.com/pytorch/pytorch/pull/131915#issuecomment-2275974907))
- [Revert "Conversions between strided and jagged layouts for Nested Tensors (#115749)"](https://github.com/pytorch/pytorch/commit/38674bcb452430b866645ca62bbbc8a0cd358c1a)
  - breaks test_overrides.py::TestTorchFunctionWarning::test_warn_on_invalid_torch_function_tensor_subclass ([comment](https://github.com/pytorch/pytorch/pull/115749#issuecomment-2270213988))
- [Revert "Refactor thunkify to return proper thunk abstraction (#132407)"](https://github.com/pytorch/pytorch/commit/baa2483ceaf38e0f8239bd866e703290a9af3645)
  - td strikes again ([comment](https://github.com/pytorch/pytorch/pull/132407#issuecomment-2269577711))

### Weird (11)

- [Revert "[BE] Raise when the target model has scalar parameters (#132934)"](https://github.com/pytorch/pytorch/commit/50595ecef4a4f9882a02539019b11a5e50295244)
  - I think this broke distributed/_composable/fsdp/test_fully_shard_init.py::TestFullyShardShardedParameterTensor::test_raise_scalar_parameter [GH job link](https://github.com/pytorch/pytorch/actions/runs/10314920655/job/28563430905) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/ea00036841b225330396f8d8f6ecf796f4826786).  Dr CI is wrong, it is not flaky ([comment](https://github.com/pytorch/pytorch/pull/132934#issuecomment-2278208789))
- [Revert "[inductor]a less ambitious way to slove the scalar tensor (#132702)"](https://github.com/pytorch/pytorch/commit/0f19d4150bc59d4467160dfd9ed346e4614975a5)
  - breaks trunk jobs higher_order_ops/test_with_effects.py::TestWithEffects::test_compile_inductor [GH job link](https://github.com/pytorch/pytorch/actions/runs/10295568902/job/28501145150) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/b483ca05a91f2876b0f1f5a435fa264f5467762d) Not run due to bad TD ([comment](https://github.com/pytorch/pytorch/pull/132702#issuecomment-2275642109))
- [Revert "Disable SymDispatchMode when torch.compile'ing (#132433)"](https://github.com/pytorch/pytorch/commit/07551887b8f9dd0b25c0ff35f2801d4b934d5237)
  - We need to now revert https://github.com/pytorch/pytorch/pull/132216 in OSS and there is a dependency on this pr ([comment](https://github.com/pytorch/pytorch/pull/132433#issuecomment-2274105080))
- [Revert "Consolidate SymDispatchMode into ProxyTensorMode (#132674)"](https://github.com/pytorch/pytorch/commit/a9ff190867da2c7dd28239d48d3d2fe33eedee31)
  - We need to now revert https://github.com/pytorch/pytorch/pull/132216 in OSS and there is a dependency on this pr ([comment](https://github.com/pytorch/pytorch/pull/132674#issuecomment-2274062785))
- [Revert "[BE] Simplify code interacting with get_proxy_mode/enable_tracing (#132675)"](https://github.com/pytorch/pytorch/commit/9d476fee537d3ba357921f2105aff49518620ff2)
  - We need to now revert https://github.com/pytorch/pytorch/pull/132216 in OSS and there is a dependency on this pr ([comment](https://github.com/pytorch/pytorch/pull/132674#issuecomment-2274062785))
- [Revert "Fix infinite recursion while walking to submodules (#132763)"](https://github.com/pytorch/pytorch/commit/17490250812e6662c8b12d7880ac425cffc93802)
  - We need to now revert https://github.com/pytorch/pytorch/pull/132216 in OSS and there is a dependency on this pr ([comment](https://github.com/pytorch/pytorch/pull/132763#issuecomment-2274059792))
- [Revert "Loads .pyd instead of .so in MemPool test for windows (#132749)"](https://github.com/pytorch/pytorch/commit/123d9ec5bfcfbe3577a724e880ca479247f17319)
  - Seems like periodic is still failing: https://hud.pytorch.org/pytorch/pytorch/commit/7c79e89bc5bb21c0c8766c7b96675791d3468b6c ([comment](https://github.com/pytorch/pytorch/pull/132749#issuecomment-2274041302))
- [Revert "Add support for other backends in get_preferred_device (#132118)"](https://github.com/pytorch/pytorch/commit/de9b8a42c1be6b6d118a470afbfee5155e8d2dd5)
  - I think this broke distributed/checkpoint/test_file_system_checkpoint_cpu.py::TestDistributedReshardOnLoad::test_load_rowwise_to_colwise_thread_count_1 [GH job link](https://github.com/pytorch/pytorch/actions/runs/10279901233/job/28456599072) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/c184ac0f6b6d2482cf300d852fde6370a1c1e086).  Dr CI classification is wrong, the failure is not flaky ([comment](https://github.com/pytorch/pytorch/pull/132118#issuecomment-2273729288))
- [Revert "[DeviceMesh] Create new group for 1D mesh when default backend is 'gloo' and 'cuda' is available (#132709)"](https://github.com/pytorch/pytorch/commit/c7113a6186182b32a1ffa4011cb1757ed78264d8)
  - I think this broke distributed/test_distributed_spawn.py::TestDistBackendWithSpawn::test_ddp_device_mesh_initialization [GH job link](https://github.com/pytorch/pytorch/actions/runs/10274519791/job/28432469987) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/1a23ef2ece1c667ee46cd34deb70df2b91bffa32).  Test not run due to bad TD ([comment](https://github.com/pytorch/pytorch/pull/132709#issuecomment-2272350923))
- [Revert "[MPS] Add support for autocast in MPS  (#99272)"](https://github.com/pytorch/pytorch/commit/2764bee942eed4a30a882dde59900ecbb04ea836)
  - Broke test/inductor/test_cpu_select_algorithm.py::TestSelectAlgorithmCPU::test_quantized_linear_amx_batch_size_3_in_features_128_out_features_64_bias_False_cpu on sm86 jobs [GH job link](https://github.com/pytorch/pytorch/actions/runs/10252979157/job/28367091621) [HUD commit link](https://hud.pytorch.org/pytorch/pytorch/commit/6919e8baaba391ced7b4acaa553d6ea1f3b30e79) Not caught on PR due to bad TD.  PR was labeled with ci-no-td but it didn't work.  Filed https://github.com/pytorch/test-infra/issues/5535 with what I think is the cause ([comment](https://github.com/pytorch/pytorch/pull/99272#issuecomment-2269808857))
- [Revert "[export] Convert autocast to HOO (#131914)"](https://github.com/pytorch/pytorch/commit/a3ea96b762cc8e7be2b144c5146ccecabdabbe14)
  - PR shouldn't have been relanded by the bot, phabricator diff did not have any recent changes and is still internally reverted ([comment](https://github.com/pytorch/pytorch/pull/131914#issuecomment-2269797388))
